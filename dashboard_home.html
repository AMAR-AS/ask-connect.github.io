<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASK Connect - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: rgba(15, 23, 42, 0.6);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --border-color: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(15, 23, 42, 0.3);
        }

        body.light-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: rgba(255, 255, 255, 0.8);
            --text-primary: #0f172a;
            --text-secondary: rgba(15, 23, 42, 0.7);
            --border-color: rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.4);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            transition: background 0.5s ease;
        }

        body::before {
            content: '';
            position: fixed;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.3) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
            z-index: 0;
        }

        @keyframes gradientShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-10%, -10%) rotate(5deg); }
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
            position: relative;
            z-index: 10;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            backdrop-filter: blur(40px) saturate(200%);
            border-right: 1px solid var(--border-color);
            padding: 30px 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .nav-item {
            padding: 14px 18px;
            margin-bottom: 8px;
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            border: 1px solid rgba(102, 126, 234, 0.5);
            color: var(--text-primary);
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 30px;
            min-height: 100vh;
        }

        .top-bar {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .theme-toggle {
            width: 60px;
            height: 30px;
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            cursor: pointer;
            position: relative;
        }

        .theme-slider {
            position: absolute;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: left 0.3s;
        }

        body.light-mode .theme-slider {
            left: 33px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .profile-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--border-color);
        }

        .profile-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(50px) saturate(200%);
            border: 1.5px solid var(--border-color);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.15);
        }

        .booking-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .booking-card {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .booking-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>

<div class="dashboard-container">
    
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-icon">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
            </div>
            <div>
                <h2 style="color: var(--text-primary); font-weight: 700; font-size: 1.2rem;">ASK Connect</h2>
                <p style="color: var(--text-secondary); font-size: 0.75rem;" id="user-name">Loading...</p>
            </div>
        </div>

        <nav>
            <div class="nav-item active" onclick="showSection('dashboard')">
                üè† Dashboard
            </div>
            <div class="nav-item" onclick="showSection('movies')">
                üé¨ Movie Tickets
            </div>
            <div class="nav-item" onclick="showSection('bus')">
                üöå Bus Tickets
            </div>
            <div class="nav-item" onclick="showSection('train')">
                üöÇ Train Tickets
            </div>
            <div class="nav-item" onclick="showSection('flight')">
                ‚úàÔ∏è Flight Tickets
            </div>
            <div class="nav-item" onclick="showSection('guide')">
                üó∫Ô∏è Tour Guides
            </div>
            <div class="nav-item" onclick="showSection('room')">
                üè† Room Booking
            </div>
            <div class="nav-item" onclick="showSection('product')">
                üõçÔ∏è Shop Products
            </div>
            <div class="nav-item" onclick="showSection('bike')">
                üèçÔ∏è Bike Rental
            </div>
            <div class="nav-item" onclick="showSection('cab')">
                üöï Cab Service
            </div>
            <div class="nav-item" onclick="showSection('food')">
                üçî Food Delivery
            </div>
            <div class="nav-item" onclick="showSection('service')">
                üîß Service Booking
            </div>
            <div class="nav-item" onclick="showSection('profile')">
                üë§ My Profile
            </div>
            <div class="nav-item" onclick="showSection('bookings')">
                üìã My Bookings
            </div>
            <div class="nav-item" onclick="handleLogout()">
                üö™ Logout
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Top Bar -->
        <div class="top-bar">
            <h1 style="color: var(--text-primary); font-weight: 700; font-size: 1.8rem;" id="page-title">Dashboard</h1>
            <div style="display: flex; gap: 20px; align-items: center;">
                <div class="theme-toggle" onclick="toggleTheme()">
                    <div class="theme-slider"></div>
                </div>
                <div class="profile-btn" onclick="showSection('profile')">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="glass-card">
                <h2 style="color: var(--text-primary); font-size: 1.5rem; font-weight: 700; margin-bottom: 20px;">Welcome to ASK Connect! üéâ</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Your all-in-one platform for booking everything from movies to travel, accommodation, and services.</p>
                
                <div class="booking-grid">
                    <div class="booking-card" onclick="showSection('movies')">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üé¨</div>
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 5px;">Movie Tickets</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Latest blockbusters</p>
                    </div>
                    
                    <div class="booking-card" onclick="showSection('bus')">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üöå</div>
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 5px;">Bus Tickets</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Comfortable travel</p>
                    </div>
                    
                    <div class="booking-card" onclick="showSection('flight')">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">‚úàÔ∏è</div>
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 5px;">Flight Tickets</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Fly anywhere</p>
                    </div>
                    
                    <div class="booking-card" onclick="showSection('room')">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üè†</div>
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 5px;">Room Booking</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Perfect stays</p>
                    </div>

                    <div class="booking-card" onclick="showSection('food')">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üçî</div>
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 5px;">Food Delivery</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Order meals</p>
                    </div>

                    <div class="booking-card" onclick="showSection('cab')">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üöï</div>
                        <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 5px;">Cab Service</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Book rides</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Movies Section -->
        <section id="movies" class="content-section">
            <div class="glass-card">
                <h2 style="color: var(--text-primary); font-size: 1.5rem; font-weight: 700; margin-bottom: 20px;">üé¨ Movie Tickets</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Book tickets for the latest movies in theaters near you.</p>
                
                <form onsubmit="bookMovie(event)" class="space-y-4">
                    <input type="text" placeholder="Movie Name" class="glass-input w-full p-3 rounded-lg" style="background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); color: var(--text-primary);" required>
                    <input type="text" placeholder="Theater" class="glass-input w-full p-3 rounded-lg" style="background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); color: var(--text-primary);" required>
                    <input type="date" class="glass-input w-full p-3 rounded-lg" style="background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); color: var(--text-primary);" required>
                    <input type="number" placeholder="Number of Tickets" min="1" class="glass-input w-full p-3 rounded-lg" style="background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); color: var(--text-primary);" required>
                    <button type="submit" class="btn-primary w-full">Book Tickets</button>
                </form>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="content-section">
            <div class="glass-card">
                <h2 style="color: var(--text-primary); font-size: 1.5rem; font-weight: 700; margin-bottom: 20px;">üë§ My Profile</h2>
                
                <div id="profile-data" style="color: var(--text-secondary);">
                    Loading profile...
                </div>
            </div>
        </section>

        <!-- My Bookings Section -->
        <section id="bookings" class="content-section">
            <div class="glass-card">
                <h2 style="color: var(--text-primary); font-size: 1.5rem; font-weight: 700; margin-bottom: 20px;">üìã My Bookings</h2>
                
                <div id="bookings-list" style="color: var(--text-secondary);">
                    Loading bookings...
                </div>
            </div>
        </section>

        <!-- Additional sections for other services would go here -->
        <!-- For brevity, they follow the same pattern as Movies -->

    </main>
</div>

<!-- Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/config.js"></script>
<script src="js/auth.js"></script>

<script>
// Navigation
function showSection(sectionId) {
    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    document.getElementById(sectionId).classList.add('active');
    event.target.classList.add('active');
    
    const titles = {
        dashboard: 'Dashboard',
        movies: 'Movie Tickets',
        bus: 'Bus Tickets',
        train: 'Train Tickets',
        flight: 'Flight Tickets',
        guide: 'Tour Guides',
        room: 'Room Booking',
        product: 'Shop Products',
        bike: 'Bike Rental',
        cab: 'Cab Service',
        food: 'Food Delivery',
        service: 'Service Booking',
        profile: 'My Profile',
        bookings: 'My Bookings'
    };
    
    document.getElementById('page-title').textContent = titles[sectionId] || 'Dashboard';
}

// Theme Toggle
function toggleTheme() {
    document.body.classList.toggle('light-mode');
    localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
}

// Load saved theme
if (localStorage.getItem('theme') === 'light') {
    document.body.classList.add('light-mode');
}

// Book Movie
async function bookMovie(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    
    showLoading('Creating booking...');
    
    // Create booking in Supabase
    const user = await getCurrentUser();
    const { error } = await supabase.from('bookings').insert([{
        user_id: user.id,
        booking_type: 'movie',
        booking_data: Object.fromEntries(formData),
        status: 'pending',
        total_amount: 500
    }]);
    
    hideLoading();
    
    if (!error) {
        showToast('Movie ticket booked successfully!', 'success');
        e.target.reset();
    } else {
        showToast('Booking failed', 'error');
    }
}

// Load user profile
async function loadProfile() {
    const profile = await getUserProfile();
    if (profile) {
        document.getElementById('user-name').textContent = profile.full_name;
        document.getElementById('profile-data').innerHTML = `
            <p><strong>Name:</strong> ${profile.full_name}</p>
            <p><strong>Email:</strong> ${profile.email}</p>
            <p><strong>Username:</strong> ${profile.username}</p>
            <p><strong>Phone:</strong> ${profile.phone || 'Not provided'}</p>
        `;
    }
}

// Load bookings
async function loadBookings() {
    const user = await getCurrentUser();
    const { data } = await supabase
        .from('bookings')
        .select('*')
        .eq('user_id', user.id)
        .order('created_at', { ascending: false });
    
    if (data && data.length > 0) {
        document.getElementById('bookings-list').innerHTML = data.map(b => `
            <div class="booking-card">
                <h3>${b.booking_type.toUpperCase()}</h3>
                <p>Status: ${b.status}</p>
                <p>Amount: ‚Çπ${b.total_amount}</p>
            </div>
        `).join('');
    } else {
        document.getElementById('bookings-list').innerHTML = '<p>No bookings yet</p>';
    }
}

// Initialize
requireAuth().then(() => {
    loadProfile();
    loadBookings();
});
</script>

</body>
</html>